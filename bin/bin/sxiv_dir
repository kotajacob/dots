#!/usr/bin/env sh

# full path to a file
abspath() {
    case "$1" in
        /*) printf "%s\n" "$1";;
        *)  printf "%s\n" "$PWD/$1";;
    esac
}

# list all images in a directory
listimages() {
    find -L "$(dirname "$target")" -maxdepth 1 -type f -iregex \
      '.*\(jpe?g\|bmp\|webp\|png\|gif\|tif\)$' -print0 | sort -z
}

target="$(abspath "$1")"
count="$(listimages | grep -a -m 1 -ZznF "$target" | cut -d: -f1)"

if [ -n "$count" ]; then
	listimages | xargs -0 sxiv -q -b -g 1280x720 -n "$count" --
else
	shift
	"$1" -- "$@" # fallback
fi
