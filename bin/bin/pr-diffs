#!/bin/sh
# usage: pr-diffs portainer/portainer-ee
# or to look at PRs against a specific branch:
# usage: pr-files portainer/portainer-ee release/2.14
#
# Diffs will be stored in /tmp/pr-diffs/portainer/portainer-ee/
# You can search this new directory with ripgrep or whatever now!

if [ -z "$1" ]
then
      echo "error: please provide a repo to search!"
	  exit 1
fi

if [ -z "$2" ]
then
	prs=$(gh search prs -L 100 --repo="$1" --state=open --json number \
		| jq '.[] | .number')
else
	prs=$(gh search prs -L 100 --repo="$1" -B="$2" --state=open --json number \
		| jq '.[] | .number')
fi

dir=/tmp/pr-diffs/"$1"
rm -rf "$dir"
mkdir -p "$dir"

for pr in $prs; do
	gh pr diff -R "$1" "$pr" > "$dir"/"$pr".diff
done
